@page "/QuantityOfTickets/{id:int}"
@using SistemaDeBilheteira.Services.API_Deserializer
@using SistemaDeBilheteira.Services.Movies
@inject MovieDeserializer MovieDeserializer
@inject GenreService GenreService

@if (movie != null)
{
    <div class="movie-info">
        <div class="movie-details">
            <h2 class="movie-title">@movie.Title</h2>
            <p class="date">Saturday, April 6th</p>
            <p class="time">21:10h</p>

            <div class="cinema-name">
                <img src="images/icons/location.svg" alt="location" class="button-icon"/>
                <p class="cinema">Cinemas NOS Forum Madeira</p>
                <p class="location">Funchal, Madeira</p>
            </div>

            <div class="session-name">
                <p class="room">Room 5</p>
            </div>
        </div>

        <div class="people-going">
            <p class="people-going-text">How many people will go ?</p>

            <div class="counter-container">
                <div class="counter-box">
                    <div class="number-display">@numberOfPeople</div>
                </div>
                <div class="counter-buttons">
                    <button class="arrow-button" @onclick="IncreasePeople">▲</button>
                    <button class="arrow-button" @onclick="DecreasePeople">▼</button>
                </div>
            </div>

            <div class="continue-container">
                <button class="primary-button">Continue</button>
            </div>
        </div>
    </div>
}
else
{
    <p>Loading movie details...</p>
}

@code {
    [Parameter] public int id { get; set; }
    private Movie? movie;
    private List<string> genreNames = new();
    private int numberOfPeople = 2;

    protected override async Task OnInitializedAsync()
    {
        movie = await MovieDeserializer.FetchMovie(id);
        var allGenres = await GenreService.GetGenresAsync();

        if (movie?.GenreIds != null)
        {
            genreNames = allGenres
                .Where(g => movie.GenreIds.Contains(g.Id))
                .Select(g => g.Name)
                .ToList();
        }
    }

    private void IncreasePeople() => numberOfPeople++;
    private void DecreasePeople()
    {
        if (numberOfPeople > 1)
            numberOfPeople--;
    }
}
